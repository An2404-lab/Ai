<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>IFS Attractor với tham số k</title>
  <style>
    body {
      font-family: sans-serif;
      background: #111;
      color: white;
      text-align: center;
    }
    canvas {
      border: 1px solid white;
      background: black;
    }
    #controls {
      margin: 10px;
    }
    input[type="range"] {
      width: 300px;
    }
  </style>
</head>
<body>
  <h2>IFS Attractor: f₁ màu xanh lá, f₂ màu đỏ</h2>
  <div id="controls">
    <label>k: <input type="number" id="kInput" value="0.5" step="0.01" min="-2" max="2"></label>
    <input type="range" id="kSlider" min="-2" max="2" step="0.01" value="0.5">
    <button onclick="draw()">Vẽ lại</button>
  </div>
  <canvas id="canvas" width="600" height="600"></canvas>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const kInput = document.getElementById("kInput");
    const kSlider = document.getElementById("kSlider");

    // Đồng bộ slider và input
    kInput.addEventListener("input", () => kSlider.value = kInput.value);
    kSlider.addEventListener("input", () => {
      kInput.value = kSlider.value;
    });

    function transform(x, y, k, which) {
      // Ma trận: [0 1; k 0]
      let newX = y;
      let newY = k * x;
      if (which === 2) {
        newY += 1 - k;
      }
      return [newX, newY];
    }

    function draw() {
      const k = parseFloat(kInput.value);
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      let x = 0, y = 0;
      const width = canvas.width;
      const height = canvas.height;

      // Ánh xạ không gian [-1.5, 1.5] x [-1.5, 1.5] lên canvas
      function toCanvas(px, py) {
        return [
          width / 2 + px * width / 3,
          height / 2 - py * height / 3
        ];
      }

      for (let i = 0; i < 100000; i++) {
        let which = Math.random() < 0.5 ? 1 : 2;
        [x, y] = transform(x, y, k, which);
        if (i > 100) { // Bỏ qua vài điểm đầu
          const [cx, cy] = toCanvas(x, y);
          ctx.fillStyle = which === 1 ? "lime" : "red";
          ctx.fillRect(cx, cy, 1, 1);
        }
      }
    }

    draw();
  </script>
</body>
</html>
